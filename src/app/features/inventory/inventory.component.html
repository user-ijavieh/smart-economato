<!-- Header -->
<div class="header-inventario">
  <h1>Inventario</h1>
</div>

<!-- Contenido -->
<div class="contenedor-principal">
  <div class="controles">
    <input type="text" [(ngModel)]="searchTerm" placeholder="Buscar producto..." (keyup.enter)="onSearch()" />
    <button (click)="onSearch()">Buscar</button>
    <button (click)="checkStock()">Comprobar Stock</button>
    <button id="btnAgregarProducto" (click)="toggleForm()">Agregar Producto</button>
    <button (click)="showAll()">Mostrar Todos</button>
  </div>

  <!-- Formulario para agregar producto -->
  @if (showForm) {
    <div class="formulario-producto">
      <h3>Agregar Nuevo Producto</h3>
      <form (ngSubmit)="submitProduct()">
        <div class="form-row">
          <div class="form-group">
            <label for="nombreProducto">Nombre *</label>
            <input type="text" id="nombreProducto" [(ngModel)]="formProduct.name" name="name" required>
          </div>
          <div class="form-group">
            <label for="precioProducto">Precio (€) *</label>
            <input type="number" id="precioProducto" [(ngModel)]="formProduct.unitPrice" name="unitPrice" step="0.01" min="0" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="stockProducto">Stock *</label>
            <input type="number" id="stockProducto" [(ngModel)]="formProduct.currentStock" name="currentStock" min="0" required>
          </div>
          <div class="form-group">
            <label for="stockMinimoProducto">Stock Mínimo *</label>
            <input type="number" id="stockMinimoProducto" [(ngModel)]="formProduct.minStock" name="minStock" min="0" required>
          </div>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-guardar">Guardar Producto</button>
          <button type="button" class="btn-cancelar" (click)="cancelForm()">Cancelar</button>
        </div>
      </form>
    </div>
  }

  <!-- Tabla de Productos -->
  <div class="tabla-contenedor">
    <table>
      <thead>
        <tr>
          <th class="sortable" (click)="sort('id')" [attr.data-sort-dir]="getSortDir('id')">ID</th>
          <th>Nombre</th>
          <th (click)="sort('unitPrice')" class="sortable" [attr.data-sort-dir]="getSortDir('unitPrice')">Precio (€)</th>
          <th (click)="sort('currentStock')" class="sortable" [attr.data-sort-dir]="getSortDir('currentStock')">Stock</th>
          <th>Stock Mínimo</th>
          <th>Proveedor</th>
        </tr>
      </thead>
      <tbody>
        @for (product of filteredProducts; track product.id) {
          <tr [class.alerta]="isLowStock(product)">
            <td>{{ product.id }}</td>
            <td>{{ product.name }}</td>
            <td>{{ product.unitPrice | number:'1.2-2' }} €</td>
            <td>{{ product.currentStock | number:'1.0-2' }}</td>
            <td>{{ product.minStock || 0 }}</td>
            <td>{{ product.supplier?.name || '—' }}</td>
          </tr>
        }
        @if (filteredProducts.length === 0 && !loading) {
          <tr><td colspan="6" style="text-align: center; padding: 2rem;">No se encontraron productos</td></tr>
        }
      </tbody>
      <tfoot>
        <tr>
          <td colspan="6">
            Total: {{ totalProducts }} productos
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
