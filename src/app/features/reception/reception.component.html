<div class="reception-page">
  <!-- Header -->
  <header class="reception-header">
    <h1>RECEPCIÓN DE ÓRDENES</h1>
  </header>

  <!-- Contenido Principal -->
  <div class="reception-content">
    @if (loading) {
      <div class="loading-message">
        <p>Cargando órdenes...</p>
      </div>
    } @else {
      <!-- PENDING Section -->
      <section class="status-section">
        <h2 class="section-title" [style.border-color]="getStatusColor('PENDING')">
          {{ getStatusLabel('PENDING') }} ({{ ordersByStatus.PENDING?.length || 0 }})
        </h2>
        @if ((ordersByStatus.PENDING?.length || 0) === 0) {
          <div class="empty-section">
            No hay órdenes pendientes
          </div>
        } @else {
          <div class="orders-container">
            @for (order of ordersByStatus.PENDING; track order.id) {
              <div class="order-card" [style.border-left-color]="getStatusColor('PENDING')">
                <div class="order-header" [style.background]="getStatusColor('PENDING')">
                  <div class="order-title">
                    <div class="order-user">
                      <div class="user-avatar">{{ getUserInitials({name: order.userName}) }}</div>
                      <div>
                        <h3>Orden #{{ order.id }}</h3>
                        <p>{{ order.userName }}</p>
                      </div>
                    </div>
                  </div>
                  <span class="order-status">{{ getStatusLabel(order.status) }}</span>
                </div>

                <div class="order-body">
                  <div class="order-detail">
                    <span class="detail-label">Fecha:</span>
                    <span class="detail-value">{{ formatDate(order.orderDate) }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Productos:</span>
                    <span class="detail-value">{{ order.details?.length || 0 }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Total:</span>
                    <span class="detail-value total">{{ getOrderTotal(order) | number:'1.2-2' }} €</span>
                  </div>

                  <div class="order-items-preview">
                    @for (detail of (order.details || []).slice(0, 2); track $index) {
                      <div class="item-preview">
                        <span>{{ detail.productName }}</span>
                        <span>{{ detail.quantity }} uds</span>
                      </div>
                    }
                    @if ((order.details?.length || 0) > 2) {
                      <div class="items-more">+{{ (order.details?.length || 0) - 2 }} más</div>
                    }
                  </div>
                </div>

                <div class="order-actions">
                  <button class="btn-action btn-details" (click)="viewOrderDetails(order)">
                    Ver Detalles
                  </button>
                  <button class="btn-action btn-primary" (click)="reviewOrder(order)">
                    Revisar Orden
                  </button>
                  <button class="btn-action btn-secondary" (click)="cancelOrder(order)">
                    Cancelar
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </section>

      <!-- IN_REVIEW Section -->
      <section class="status-section">
        <h2 class="section-title" [style.border-color]="getStatusColor('REVIEW')">
          {{ getStatusLabel('REVIEW') }} ({{ ordersByStatus.REVIEW?.length || 0 }})
        </h2>
        @if ((ordersByStatus.REVIEW?.length || 0) === 0) {
          <div class="empty-section">
            No hay órdenes en revisión
          </div>
        } @else {
          <div class="orders-container">
            @for (order of ordersByStatus.REVIEW; track order.id) {
              <div class="order-card" [style.border-left-color]="getStatusColor('REVIEW')">
                <div class="order-header" [style.background]="getStatusColor('REVIEW')">
                  <div class="order-title">
                    <div class="order-user">
                      <div class="user-avatar">{{ getUserInitials({name: order.userName}) }}</div>
                      <div>
                        <h3>Orden #{{ order.id }}</h3>
                        <p>{{ order.userName }}</p>
                      </div>
                    </div>
                  </div>
                  <span class="order-status">{{ getStatusLabel(order.status) }}</span>
                </div>

                <div class="order-body">
                  <div class="order-detail">
                    <span class="detail-label">Fecha:</span>
                    <span class="detail-value">{{ formatDate(order.orderDate) }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Productos:</span>
                    <span class="detail-value">{{ order.details?.length || 0 }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Total:</span>
                    <span class="detail-value total">{{ getOrderTotal(order) | number:'1.2-2' }} €</span>
                  </div>

                  <div class="order-items-preview">
                    @for (detail of (order.details || []).slice(0, 2); track $index) {
                      <div class="item-preview">
                        <span>{{ detail.productName }}</span>
                        <span>{{ detail.quantity }} uds</span>
                      </div>
                    }
                    @if ((order.details?.length || 0) > 2) {
                      <div class="items-more">+{{ (order.details?.length || 0) - 2 }} más</div>
                    }
                  </div>
                </div>

                <div class="order-actions">
                  <button class="btn-action btn-details" (click)="viewOrderDetails(order)">
                    Ver Detalles
                  </button>
                  <button class="btn-action btn-success" (click)="confirmOrder(order)">
                    Confirmar Completa
                  </button>
                  <button class="btn-action btn-danger" (click)="markIncomplete(order)">
                    Marcar Incompleta
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </section>

      <!-- CONFIRMED Section -->
      <section class="status-section">
        <h2 class="section-title" [style.border-color]="getStatusColor('COMPLETED')">
          {{ getStatusLabel('COMPLETED') }} ({{ ordersByStatus.COMPLETED?.length || 0 }})
        </h2>
        @if ((ordersByStatus.COMPLETED?.length || 0) === 0) {
          <div class="empty-section">
            No hay órdenes confirmadas
          </div>
        } @else {
          <div class="orders-container">
            @for (order of ordersByStatus.COMPLETED; track order.id) {
              <div class="order-card completed" [style.border-left-color]="getStatusColor('COMPLETED')">
                <div class="order-header" [style.background]="getStatusColor('COMPLETED')">
                  <div class="order-title">
                    <div class="order-user">
                      <div class="user-avatar">{{ getUserInitials({name: order.userName}) }}</div>
                      <div>
                        <h3>Orden #{{ order.id }}</h3>
                        <p>{{ order.userName }}</p>
                      </div>
                    </div>
                  </div>
                  <span class="order-status">{{ getStatusLabel(order.status) }}</span>
                </div>

                <div class="order-body">
                  <div class="order-detail">
                    <span class="detail-label">Fecha:</span>
                    <span class="detail-value">{{ formatDate(order.orderDate) }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Productos:</span>
                    <span class="detail-value">{{ order.details?.length || 0 }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Total:</span>
                    <span class="detail-value total">{{ getOrderTotal(order) | number:'1.2-2' }} €</span>
                  </div>

                  <div class="order-items-preview">
                    @for (detail of (order.details || []).slice(0, 2); track $index) {
                      <div class="item-preview">
                        <span>{{ detail.productName }}</span>
                        <span>{{ detail.quantity }} uds</span>
                      </div>
                    }
                    @if ((order.details?.length || 0) > 2) {
                      <div class="items-more">+{{ (order.details?.length || 0) - 2 }} más</div>
                    }
                  </div>
                </div>

                <div class="order-actions">
                  <button class="btn-action btn-details" (click)="viewOrderDetails(order)">
                    Ver Detalles
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </section>

      <!-- INCOMPLETE Section -->
      <section class="status-section">
        <h2 class="section-title" [style.border-color]="getStatusColor('INCOMPLETE')">
          {{ getStatusLabel('INCOMPLETE') }} ({{ ordersByStatus.INCOMPLETE?.length || 0 }})
        </h2>
        @if ((ordersByStatus.INCOMPLETE?.length || 0) === 0) {
          <div class="empty-section">
            No hay órdenes incompletas
          </div>
        } @else {
          <div class="orders-container">
            @for (order of ordersByStatus.INCOMPLETE; track order.id) {
              <div class="order-card incomplete" [style.border-left-color]="getStatusColor('INCOMPLETE')">
                <div class="order-header" [style.background]="getStatusColor('INCOMPLETE')">
                  <div class="order-title">
                    <div class="order-user">
                      <div class="user-avatar">{{ getUserInitials({name: order.userName}) }}</div>
                      <div>
                        <h3>Orden #{{ order.id }}</h3>
                        <p>{{ order.userName }}</p>
                      </div>
                    </div>
                  </div>
                  <span class="order-status">{{ getStatusLabel(order.status) }}</span>
                </div>

                <div class="order-body">
                  <div class="order-detail">
                    <span class="detail-label">Fecha:</span>
                    <span class="detail-value">{{ formatDate(order.orderDate) }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Productos:</span>
                    <span class="detail-value">{{ order.details?.length || 0 }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Total:</span>
                    <span class="detail-value total">{{ getOrderTotal(order) | number:'1.2-2' }} €</span>
                  </div>

                  <div class="order-items-preview">
                    @for (detail of (order.details || []).slice(0, 2); track $index) {
                      <div class="item-preview">
                        <span>{{ detail.productName }}</span>
                        <span>{{ detail.quantity }} uds</span>
                      </div>
                    }
                    @if ((order.details?.length || 0) > 2) {
                      <div class="items-more">+{{ (order.details?.length || 0) - 2 }} más</div>
                    }
                  </div>
                </div>

                <div class="order-actions">
                  <button class="btn-action btn-details" (click)="viewOrderDetails(order)">
                    Ver Detalles
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </section>

      <!-- CANCELLED Section -->
      <section class="status-section">
        <h2 class="section-title" [style.border-color]="getStatusColor('CANCELLED')">
          {{ getStatusLabel('CANCELLED') }} ({{ ordersByStatus.CANCELLED?.length || 0 }})
        </h2>
        @if ((ordersByStatus.CANCELLED?.length || 0) === 0) {
          <div class="empty-section">
            No hay órdenes canceladas
          </div>
        } @else {
          <div class="orders-container">
            @for (order of ordersByStatus.CANCELLED; track order.id) {
              <div class="order-card cancelled" [style.border-left-color]="getStatusColor('CANCELLED')">
                <div class="order-header" [style.background]="getStatusColor('CANCELLED')">
                  <div class="order-title">
                    <div class="order-user">
                      <div class="user-avatar">{{ getUserInitials({name: order.userName}) }}</div>
                      <div>
                        <h3>Orden #{{ order.id }}</h3>
                        <p>{{ order.userName }}</p>
                      </div>
                    </div>
                  </div>
                  <span class="order-status">{{ getStatusLabel(order.status) }}</span>
                </div>

                <div class="order-body">
                  <div class="order-detail">
                    <span class="detail-label">Fecha:</span>
                    <span class="detail-value">{{ formatDate(order.orderDate) }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Productos:</span>
                    <span class="detail-value">{{ order.details?.length || 0 }}</span>
                  </div>
                  <div class="order-detail">
                    <span class="detail-label">Total:</span>
                    <span class="detail-value total">{{ getOrderTotal(order) | number:'1.2-2' }} €</span>
                  </div>

                  <div class="order-items-preview">
                    @for (detail of (order.details || []).slice(0, 2); track $index) {
                      <div class="item-preview">
                        <span>{{ detail.productName }}</span>
                        <span>{{ detail.quantity }} uds</span>
                      </div>
                    }
                    @if ((order.details?.length || 0) > 2) {
                      <div class="items-more">+{{ (order.details?.length || 0) - 2 }} más</div>
                    }
                  </div>
                </div>

                <div class="order-actions">
                  <button class="btn-action btn-details" (click)="viewOrderDetails(order)">
                    Ver Detalles
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </section>
    }
  </div>
</div>

<!-- Details Modal -->
@if (showDetailsModal && selectedOrder) {
  <app-order-details-modal
    [order]="selectedOrder"
    (closeModal)="closeDetailsModal()"
  ></app-order-details-modal>
}
