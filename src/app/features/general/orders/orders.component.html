<!-- Header -->
<div class="header-pedidos">
  <h1>PEDIDOS</h1>
</div>

<!-- Contenido -->
<div class="contenedor-principal">
  <!-- Action Button -->
  <div class="top-actions">
    <button class="btn-create-order" (click)="openCreateOrderModal()">
      + CREAR PEDIDO
    </button>
  </div>

  <!-- Orders Grid -->
  @if (loading) {
    <div class="loading-message">
      <p>Cargando pedidos...</p>
    </div>
  } @else if (orders.length === 0) {
    <div class="empty-state">
      <h3>No hay pedidos pendientes</h3>
      <p>Crea un nuevo pedido para comenzar</p>
    </div>
  } @else {
    <div class="orders-grid">
      @for (order of displayedOrders; track order.id) {
        <div class="order-card">
          <div class="order-card-header">
            <div class="order-card-user">
              <div class="user-avatar">{{ getUserInitials({name: order.userName}) }}</div>
              <div class="user-info">
                <h4>Pedido #{{ order.id }}</h4>
                <p>{{ order.userName || 'Usuario desconocido' }}</p>
              </div>
            </div>
            <span class="order-status created">CREADO</span>
          </div>

          <div class="order-card-body">
            <div class="order-detail">
              <span class="detail-label">Fecha:</span>
              <span class="detail-value">{{ formatDate(order.orderDate) }}</span>
            </div>
            <div class="order-detail">
              <span class="detail-label">Productos:</span>
              <span class="detail-value">{{ order.details?.length || 0 }}</span>
            </div>
            <div class="order-detail total">
              <span class="detail-label">Total:</span>
              <span class="detail-value">{{ getOrderTotal(order) | number:'1.2-2' }} €</span>
            </div>
          </div>

          <div class="order-items-preview">
            @for (detail of (order.details || []).slice(0, 3); track $index) {
              @if (detail.productName) {
                <div class="item-preview">
                  <span class="item-name">{{ detail.productName }}</span>
                  <span class="item-qty">{{ detail.quantity }}</span>
                </div>
              }
            }
            @if ((order.details?.length || 0) > 3) {
              <div class="items-more">+{{ (order.details?.length || 0) - 3 }} más</div>
            }
          </div>

          <div class="order-card-actions">

            <button class="btn-action btn-details" (click)="viewOrderDetails(order)">
              Ver Detalles
            </button>
            <button class="btn-action btn-confirm" (click)="confirmOrder(order)">
              Confirmar Pedido
            </button>
          </div>
        </div>
      }
    </div>

    @if (hasMoreOrders) {
      <div class="load-more-container">
        <button class="btn-load-more" (click)="loadMore()">
          Cargar más antiguas ({{ orders.length - displayCount }} restantes)
        </button>
      </div>
    }
  }
</div>

<!-- Modal -->
@if (showModal) {
  <app-order-modal
    (closeModal)="closeModal()"
    (orderCreated)="onOrderCreated()"
  ></app-order-modal>
}

<!-- Details Modal -->
@if (showDetailsModal && selectedOrder) {
  <app-order-details-modal
    [order]="selectedOrder"
    (closeModal)="closeDetailsModal()"
  ></app-order-details-modal>
}
