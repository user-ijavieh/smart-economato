<div class="change-password-wrapper">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="lock-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>
            <h2>Cambio de Contraseña</h2>
            <p class="subtitle">Es tu primer inicio de sesión. Por seguridad, debes cambiar tu contraseña.</p>
        </div>

        <!-- Form -->
        <div class="form-section">
            <form [formGroup]="form" (ngSubmit)="onSubmit()">

                <label for="oldPassword">Contraseña Actual</label>
                <input id="oldPassword" type="password" formControlName="oldPassword"
                    placeholder="La contraseña que usaste para entrar"
                    [class.input-error]="form.get('oldPassword')?.invalid && form.get('oldPassword')?.touched" />
                @if (form.get('oldPassword')?.hasError('required') && form.get('oldPassword')?.touched) {
                <p class="field-error">La contraseña actual es requerida</p>
                }

                <label for="newPassword">Nueva Contraseña</label>
                <input id="newPassword" type="password" formControlName="newPassword" placeholder="Mínimo 8 caracteres"
                    [class.input-error]="newPasswordCtrl?.invalid && newPasswordCtrl?.touched" />

                <!-- Password requirements -->
                <div class="password-requirements"
                    [class.show-errors]="newPasswordCtrl?.invalid && newPasswordCtrl?.touched">
                    <p class="req-title">La contraseña debe tener al menos:</p>
                    <ul class="req-list">
                        <li
                            [class.valid]="!newPasswordCtrl?.hasError('minLength') && (newPasswordCtrl?.value || '').length > 0">
                            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2"
                                fill="none">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            8 caracteres
                        </li>
                        <li
                            [class.valid]="!newPasswordCtrl?.hasError('uppercase') && (newPasswordCtrl?.value || '').length > 0">
                            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2"
                                fill="none">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            1 mayúscula
                        </li>
                        <li
                            [class.valid]="!newPasswordCtrl?.hasError('lowercase') && (newPasswordCtrl?.value || '').length > 0">
                            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2"
                                fill="none">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            1 minúscula
                        </li>
                        <li
                            [class.valid]="!newPasswordCtrl?.hasError('number') && (newPasswordCtrl?.value || '').length > 0">
                            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2"
                                fill="none">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            1 número
                        </li>
                        <li
                            [class.valid]="!newPasswordCtrl?.hasError('symbol') && (newPasswordCtrl?.value || '').length > 0">
                            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2"
                                fill="none">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            1 símbolo
                        </li>
                    </ul>
                </div>

                <label for="confirmPassword">Confirmar Contraseña</label>
                <input id="confirmPassword" type="password" formControlName="confirmPassword"
                    placeholder="Repite la nueva contraseña"
                    [class.input-error]="(form.get('confirmPassword')?.invalid || form.hasError('passwordMismatch')) && form.get('confirmPassword')?.touched" />
                @if (form.get('confirmPassword')?.hasError('required') && form.get('confirmPassword')?.touched) {
                <p class="field-error">Debes confirmar la contraseña</p>
                }
                @if (form.hasError('passwordMismatch') && form.get('confirmPassword')?.touched) {
                <p class="field-error">Las contraseñas no coinciden</p>
                }

                <button type="submit" class="btn-submit" [disabled]="loading || form.invalid">
                    @if (loading) {
                    <span class="spinner"></span>
                    Cambiando...
                    } @else {
                    Cambiar Contraseña
                    }
                </button>

            </form>
        </div>
    </div>
</div>